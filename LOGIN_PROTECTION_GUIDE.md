# ç™»å½•ä¿æŠ¤åŠŸèƒ½è¯´æ˜

## âœ… å·²å®ç°çš„åŠŸèƒ½

ä¸ºäº†ä¿æŠ¤éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®çš„é¡µé¢ï¼Œæˆ‘æ·»åŠ äº†ä»¥ä¸‹åŠŸèƒ½ï¼š

### 1. è·¯ç”±ä¸­é—´ä»¶ä¿æŠ¤ (`middleware.ts`)

åˆ›å»ºäº† Next.js ä¸­é—´ä»¶æ¥ä¿æŠ¤ä»¥ä¸‹è·¯ç”±ï¼š
- `/build` - è£…æœºé…ç½®é¡µé¢
- `/ai-assistant` - AIæ¨èé¡µé¢  
- `/config` - é…ç½®å•ç®¡ç†é¡µé¢

**å·¥ä½œåŸç†ï¼š**
- æ£€æŸ¥ç”¨æˆ·æ˜¯å¦æœ‰ç™»å½•å‡­è¯ï¼ˆcookieä¸­çš„ `user_token` å’Œ `user_id`ï¼‰
- å¦‚æœæœªç™»å½•ï¼Œè‡ªåŠ¨é‡å®šå‘åˆ°ç™»å½•é¡µé¢
- ä¿ç•™åŸå§‹è®¿é—®è·¯å¾„ï¼Œç™»å½•åè‡ªåŠ¨è·³è½¬å›å»

### 2. ç™»å½•é¡µé¢ (`/login`)

**åŠŸèƒ½ç‰¹æ€§ï¼š**
- é‚®ç®±å’Œå¯†ç ç™»å½•
- è®°ä½æˆ‘é€‰é¡¹
- å¿˜è®°å¯†ç é“¾æ¥
- ç™»å½•æˆåŠŸåè‡ªåŠ¨è·³è½¬
- é”™è¯¯æç¤º

**ä¸´æ—¶æ–¹æ¡ˆï¼š**
- å½“åç«¯APIæœªå°±ç»ªæ—¶ï¼Œä½¿ç”¨æ¨¡æ‹Ÿç™»å½•
- å¼€å‘ç¯å¢ƒä¸‹ä¼šæ˜¾ç¤ºæç¤ºä¿¡æ¯

### 3. åç«¯ç™»å½•API

**æ¥å£ï¼š** `POST /api/user/login`

**è¯·æ±‚ï¼š**
```json
{
  "email": "user@example.com",
  "password": "password123"
}
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "message": "ç™»å½•æˆåŠŸ",
  "data": {
    "id": 1,
    "username": "testuser",
    "email": "user@example.com",
    "displayName": "æµ‹è¯•ç”¨æˆ·",
    "token": "uuid-token-here"
  }
}
```

### 4. å¯¼èˆªæ æ›´æ–°

æ·»åŠ äº†ï¼š
- **ç™»å½•æŒ‰é’®** - è·³è½¬åˆ°ç™»å½•é¡µé¢
- **æ³¨å†ŒæŒ‰é’®** - è·³è½¬åˆ°æ³¨å†Œé¡µé¢

## ğŸ“‚ æ–°å¢æ–‡ä»¶

### å‰ç«¯æ–‡ä»¶
```
BuildMaster-UI/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ middleware.ts                    # è·¯ç”±ä¿æŠ¤ä¸­é—´ä»¶ â­æ–°å¢
â”‚   â””â”€â”€ app/
â”‚       â””â”€â”€ login/
â”‚           â””â”€â”€ page.tsx                 # ç™»å½•é¡µé¢ â­æ–°å¢
```

### åç«¯æ–‡ä»¶
```
BuildMaster-API/
â””â”€â”€ src/main/java/com/buildmaster/
    â”œâ”€â”€ dto/
    â”‚   â”œâ”€â”€ LoginRequest.java            # ç™»å½•è¯·æ±‚DTO â­æ–°å¢
    â”‚   â””â”€â”€ LoginResponse.java           # ç™»å½•å“åº”DTO â­æ–°å¢
    â”œâ”€â”€ service/
    â”‚   â””â”€â”€ UserService.java             # æ·»åŠ login()æ–¹æ³• â­æ›´æ–°
    â””â”€â”€ controller/
        â””â”€â”€ UserController.java          # æ·»åŠ ç™»å½•æ¥å£ â­æ›´æ–°
```

### é…ç½®å˜æ›´
```
BuildMaster-UI/
â””â”€â”€ src/app/
    â””â”€â”€ layout.tsx                       # å¯¼èˆªæ æ·»åŠ ç™»å½•/æ³¨å†ŒæŒ‰é’® â­æ›´æ–°
```

## ğŸ”’ å—ä¿æŠ¤çš„è·¯ç”±

è®¿é—®ä»¥ä¸‹é¡µé¢éœ€è¦å…ˆç™»å½•ï¼š

| è·¯ç”± | è¯´æ˜ | éœ€è¦ç™»å½• |
|------|------|---------|
| `/` | é¦–é¡µ | âŒ ä¸éœ€è¦ |
| `/register` | æ³¨å†Œé¡µé¢ | âŒ ä¸éœ€è¦ |
| `/login` | ç™»å½•é¡µé¢ | âŒ ä¸éœ€è¦ |
| `/build` | è£…æœºé…ç½®å™¨ | âœ… **éœ€è¦** |
| `/ai-assistant` | AIæ¨è | âœ… **éœ€è¦** |
| `/config/*` | é…ç½®å•ç®¡ç† | âœ… **éœ€è¦** |

## ğŸš€ ä½¿ç”¨æµç¨‹

### æ–°ç”¨æˆ·æµç¨‹
1. è®¿é—® `/register` æ³¨å†Œè´¦æˆ·
2. å¡«å†™ä¿¡æ¯å¹¶è·å–é‚®ç®±éªŒè¯ç 
3. å®Œæˆæ³¨å†Œåè·³è½¬åˆ°ç™»å½•é¡µ
4. ç™»å½•æˆåŠŸå³å¯è®¿é—®æ‰€æœ‰åŠŸèƒ½

### è€ç”¨æˆ·æµç¨‹
1. è®¿é—® `/login` ç™»å½•
2. è¾“å…¥é‚®ç®±å’Œå¯†ç 
3. ç™»å½•æˆåŠŸåå¯è®¿é—®å—ä¿æŠ¤é¡µé¢

### ç›´æ¥è®¿é—®å—ä¿æŠ¤é¡µé¢
1. ç”¨æˆ·è®¿é—® `/build`ï¼ˆæœªç™»å½•ï¼‰
2. è‡ªåŠ¨è·³è½¬åˆ° `/login?redirect=/build`
3. ç™»å½•æˆåŠŸåè‡ªåŠ¨è·³è½¬å› `/build`

## ğŸ’» å¼€å‘æµ‹è¯•

### æ–¹å¼1ï¼šå®Œæ•´æ³¨å†Œç™»å½•æµç¨‹

```bash
# 1. ç¡®ä¿åç«¯å’ŒRedisè¿è¡Œ
cd BuildMaster-API
mvn spring-boot:run

# 2. å¯åŠ¨å‰ç«¯
cd BuildMaster-UI
npm run dev

# 3. è®¿é—®æ³¨å†Œé¡µé¢
æµè§ˆå™¨è®¿é—®: http://localhost:3000/register

# 4. å®Œæˆæ³¨å†Œåç™»å½•
æµè§ˆå™¨è®¿é—®: http://localhost:3000/login
```

### æ–¹å¼2ï¼šä½¿ç”¨æ¨¡æ‹Ÿç™»å½•ï¼ˆå¼€å‘ç¯å¢ƒï¼‰

å¦‚æœåç«¯æœªå¯åŠ¨ï¼Œå‰ç«¯ä¼šè‡ªåŠ¨ä½¿ç”¨æ¨¡æ‹Ÿç™»å½•ï¼š
1. è®¿é—® http://localhost:3000/login
2. è¾“å…¥ä»»æ„é‚®ç®±å’Œå¯†ç 
3. ç‚¹å‡»ç™»å½•ï¼ˆä¼šçœ‹åˆ°é»„è‰²æç¤ºæ¡†ï¼‰
4. è‡ªåŠ¨è®¾ç½®æ¨¡æ‹Ÿtokenå’Œuser_id
5. å¯ä»¥è®¿é—®å—ä¿æŠ¤é¡µé¢

### æ–¹å¼3ï¼šæ‰‹åŠ¨è®¾ç½®Cookieï¼ˆå¿«é€Ÿæµ‹è¯•ï¼‰

åœ¨æµè§ˆå™¨æ§åˆ¶å°è¿è¡Œï¼š
```javascript
document.cookie = "user_token=test_token; path=/; max-age=86400";
document.cookie = "user_id=1; path=/; max-age=86400";
localStorage.setItem('user', JSON.stringify({
  id: 1,
  username: 'testuser',
  email: 'test@example.com'
}));
location.reload();
```

## ğŸ”§ é…ç½®è¯´æ˜

### ä¿®æ”¹å—ä¿æŠ¤è·¯ç”±

ç¼–è¾‘ `BuildMaster-UI/src/middleware.ts`ï¼š

```typescript
// æ·»åŠ éœ€è¦ä¿æŠ¤çš„è·¯ç”±
const protectedRoutes = [
  '/build', 
  '/ai-assistant', 
  '/config',
  '/your-new-route'  // æ·»åŠ æ–°è·¯ç”±
];

// æ·»åŠ å…¬å¼€è·¯ç”±
const publicRoutes = [
  '/', 
  '/register', 
  '/login',
  '/your-public-route'  // æ·»åŠ å…¬å¼€è·¯ç”±
];
```

### è‡ªå®šä¹‰ç™»å½•æ£€æŸ¥é€»è¾‘

ä¿®æ”¹ `middleware.ts` ä¸­çš„è®¤è¯æ£€æŸ¥ï¼š

```typescript
// å½“å‰ä½¿ç”¨cookieæ£€æŸ¥
const token = request.cookies.get('user_token');
const userId = request.cookies.get('user_id');

// å¯ä»¥æ”¹ä¸ºJWTéªŒè¯
// const token = request.cookies.get('jwt_token');
// const isValid = await verifyJWT(token);
```

## âš ï¸ æ³¨æ„äº‹é¡¹

### å½“å‰é™åˆ¶

1. **ç®€å•Token** - ä½¿ç”¨UUIDè€ŒéJWTï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦å‡çº§
2. **Cookieå­˜å‚¨** - Tokenå­˜å‚¨åœ¨cookieä¸­ï¼Œå¯èƒ½éœ€è¦HttpOnlyæ ‡å¿—
3. **æ— åˆ·æ–°åŠŸèƒ½** - Tokenè¿‡æœŸåéœ€è¦é‡æ–°ç™»å½•
4. **å‰ç«¯éªŒè¯** - ä»…åœ¨å‰ç«¯éªŒè¯ï¼Œåç«¯APIä¹Ÿéœ€è¦éªŒè¯

### å®‰å…¨å»ºè®®

1. âœ… ä½¿ç”¨HTTPSï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰
2. âœ… å®ç°JWT tokenè®¤è¯
3. âœ… è®¾ç½®tokenè¿‡æœŸæ—¶é—´
4. âœ… å®ç°tokenåˆ·æ–°æœºåˆ¶
5. âœ… åç«¯APIæ·»åŠ è®¤è¯ä¸­é—´ä»¶
6. âœ… ä½¿ç”¨HttpOnly Cookieé˜²æ­¢XSS

## ğŸ¯ ä¸‹ä¸€æ­¥æ”¹è¿›

- [ ] å®ç°JWT tokenæ›¿ä»£ç®€å•UUID
- [ ] æ·»åŠ tokenè‡ªåŠ¨åˆ·æ–°
- [ ] å®ç°é€€å‡ºç™»å½•åŠŸèƒ½
- [ ] æ·»åŠ ç”¨æˆ·ä¸ªäººä¸­å¿ƒ
- [ ] æ˜¾ç¤ºå·²ç™»å½•ç”¨æˆ·ä¿¡æ¯
- [ ] å®ç°"è®°ä½æˆ‘"åŠŸèƒ½
- [ ] æ·»åŠ å¿˜è®°å¯†ç åŠŸèƒ½
- [ ] åç«¯APIæ·»åŠ ç»Ÿä¸€è®¤è¯æ‹¦æˆªå™¨

## ğŸ“š ç›¸å…³æ–‡æ¡£

- æ³¨å†ŒåŠŸèƒ½ï¼š`EMAIL_REGISTRATION_SETUP.md`
- é‚®ç®±é…ç½®ï¼š`BuildMaster-API/EMAIL_SETUP_GUIDE.md`
- APIä½¿ç”¨ï¼š`BuildMaster-API/API_USAGE_EXAMPLE.md`

---

**ç°åœ¨è®¿é—® `/build` æˆ– `/ai-assistant` ä¼šè‡ªåŠ¨è¦æ±‚ç™»å½•ï¼** ğŸ”

